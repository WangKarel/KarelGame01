<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>坦克大战模型v1.0</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.js"></script>
</head>
<style type="text/css">
    html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
    }

    .father {
        width: 99.5%;
        height: 99.5%;
        margin: 0;
        padding: 0;
        border: black 1px solid;
        overflow: hidden;
    }

    #divId {
        position: absolute;
        width: 110px;
        height: 110px;
        top: 45%;
        left: 45%;
        padding: 0;
        margin: 0;
    }

    #bodyId {
        position: relative;
        width: 76px;
        height: 76px;
        border: black 2px solid;
        border-radius: 30%;
        margin: 0;
        left: 15px;
    }

    #shootId {
        position: relative;
        width: 26px;
        height: 26px;
        border: black 2px solid;
        border-radius: 30%;
        margin: 0;
        padding: 0;
        left: 40px;
    }

    #zidanId {
        position: relative;
        width: 10px;
        height: 20px;
        border-radius: 50%;
        background-color: black;
        left: 8px;
        top: -22px;
        visibility: hidden;
    }
</style>
<body>
<script type="text/javascript">

    $(function () {
        let zidanObj = document.getElementById("zidanId");
        let divObj = document.getElementById("divId");
        let top = false, bottom = false, left = false, right = false, enter = false;
        //定义变量保存div方位
        let flag = 1;//1:top  2:right  3:bottom  4:left
        let mytimer = '';
        //页面宽度和高度
        let winWidth = parseInt($(".father").css("width"));
        let winHeight = parseInt($(".father").css("height"));
        function zidanfeiTop() {
            //子弹碰到边距之后消失
            if ($(zidanObj).offset().top <= 0) {
                //alert($(zidanObj).offset().top)
                $(zidanObj).css({
                    visibility:"hidden",
                });
                $(zidanObj).animate({top: "-22px"}, 1);
                clearInterval(mytimer);
            } else {
                $(zidanObj).animate({top: "-=10px"},20);
            }
        }
        function zidanfeiRight() {
            //子弹碰到边距之后消失
            if (winWidth-$(zidanObj).offset().left-20 <= 0) {
                //alert($(zidanObj).offset().top)
                enter = false;
                $(zidanObj).css({
                    visibility:"hidden",
                });
                $(zidanObj).animate({top: "-22px"}, 1);
                clearInterval(mytimer);
            } else {
                $(zidanObj).animate({top: "-=10px"},20);
            }
        }
        function zidanfeiBottom() {
            //子弹碰到边距之后消失
            if (winHeight-$(zidanObj).offset().top-20 <= 0) {
                //alert($(zidanObj).offset().top)
                enter = false;
                $(zidanObj).css({
                    visibility:"hidden",
                });
                $(zidanObj).animate({top: "-22px"}, 1);
                clearInterval(mytimer);
            } else {
                $(zidanObj).animate({top: "-=10px"},20);
            }
        }
        function zidanfeiLeft() {
            //子弹碰到边距之后消失
            if ($(zidanObj).offset().left <= 0) {
                //alert($(zidanObj).offset().top)
                enter = false;
                $(zidanObj).css({
                    visibility:"hidden",
                });
                $(zidanObj).animate({top: "-22px"}, 1);
                clearInterval(mytimer);
            } else {
                $(zidanObj).animate({top: "-=10px"},20);
            }
        }

        $(document).keydown(function (event) {
            //keydown和keyup事件中event.which用于获取键值，event.keyCode已过时
            let keyNum1 = event.which;
            switch (keyNum1) {
                case 65:
                    left = true;
                    break;
                case 87:
                    top = true;
                    break;
                case 68:
                    right = true;
                    break;
                case 83:
                    bottom = true;
                    break;
            }
        });

        $(document).keydown(function (event) {
            let keyNum3 = event.which;
            if (keyNum3 === 13) {
                enter = true;
            }
        });

        $(document).keyup(function (event) {
            let keyNum2 = event.which;
            switch (keyNum2) {
                case 65:
                    left = false;
                    break;
                case 87:
                    top = false;
                    break;
                case 68:
                    right = false;
                    break;
                case 83:
                    bottom = false;
                    break;
            }
        });

        //方案一：
        /**
         * animate用于改变参数属性，与其他改变属性方法不同的是，animate是动态改变，其他的为瞬时改变；
         * animate第二个参数为延时，当animate在定时器中使用的时候一定要加上第二个参数，切数值必须小于定时器延时
         * 否则定时器无效或延时错误
         */
        setInterval(function () {
            if (left) {
                //这里的旋转角度都是相对原始位置而言的
                $("#divId").css("transform", "rotate(270deg)");
                if (parseInt($(divObj).css("left")) < 5) {
                    $(divObj).animate({left: "-=0px"}, 1);
                    //left = false;
                } else {
                    $(divObj).animate({left: "-=5px"}, 10);
                }
                flag = 4;
            } else if (top) {
                $("#divId").css("transform", "rotate(0)");
                if (parseInt($(divObj).css("top")) < 5) {
                    $(divObj).animate({top: "-=0px"}, 1);
                    //top = false;
                } else {
                    $(divObj).animate({top: "-=5px"}, 10);
                }
                flag = 1;
            } else if (right) {
                $("#divId").css("transform", "rotate(90deg)");
                if (parseInt(winWidth-$(divObj).offset().left-110) < 5) {
                    $(divObj).animate({left: "+=0px"}, 1);
                    //right = false;
                } else {
                    $(divObj).animate({left: "+=5px"}, 10);
                }
                flag = 2;
            } else if (bottom) {
                $("#divId").css("transform", "rotate(180deg)");
                if (parseInt(winHeight-$(divObj).offset().top-110) < 5) {
                    $(divObj).animate({top: "+=0px"}, 1);
                    //bottom = false;
                } else {
                    $(divObj).animate({top: "+=5px"}, 10);
                }
                flag = 3;
            }
        }, 60);

        setInterval(function () {
            if (enter) {
                //父级元素到页面顶部的距离
                //alert($(zidanObj.offsetParent).offset().top);
                //子弹到页面顶部的距离
                //alert($(zidanObj).offset().top);
                //判断子弹visibility是否为hidden，若为hidden就发射，否则不发射
                if ($(zidanObj).css("visibility") === "hidden") {
                    enter = false;
                    $(zidanObj).css("visibility", "visible");
                    switch (flag) {
                        case 1:
                            mytimer = setInterval(zidanfeiTop, 20);
                            break;
                        case 2:
                            mytimer = setInterval(zidanfeiRight, 20);
                            break;
                        case 3:
                            mytimer = setInterval(zidanfeiBottom, 20);
                            break;
                        case 4:
                            mytimer = setInterval(zidanfeiLeft, 20);
                            break;
                    }
                }
            }
        },60)

        //方案二：
        /*setInterval(function () {
            if (left) {
                divObj.style.left = divObj.offsetLeft-5+"px";
            } else if (top) {
                divObj.style.top = divObj.offsetTop-5+"px";
            } else if (right) {
                divObj.style.left = divObj.offsetLeft+5+"px";
            } else if (bottom) {
                divObj.style.top = divObj.offsetTop+5+"px";
            }
        },50);*/
    })
</script>
<div class="father">
    <div id="divId">
        <div id="shootId">
            <div id="zidanId"></div>
        </div>
        <div id="bodyId">

        </div>
    </div>
</div>


</body>
</html>